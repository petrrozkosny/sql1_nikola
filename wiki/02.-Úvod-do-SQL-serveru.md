# Úvod do SQL Serveru a SQL

## 1. Úvod do SQL Serveru
SQL Server je relační databázový systém (RDBMS) vyvinutý společností Microsoft. Slouží k ukládání, správě a načítání dat, která jsou organizována do tabulek s řádky a sloupci. SQL Server podporuje širokou škálu funkcí včetně transakčního zpracování, business intelligence a analýzy dat. Je vhodný pro různé typy aplikací, od malých aplikací až po rozsáhlé enterprise systémy. SQL Server nabízí různé edice, například Express, Standard a Enterprise, které se liší funkcemi a kapacitou.

## 2. Základní informace o jazyku SQL a historie
SQL (Structured Query Language) je standardizovaný jazyk používaný pro správu relačních databází. Byl vyvinut v 70. letech minulého století v laboratořích IBM a jeho první komerční implementace byla realizována společností Oracle v roce 1979. SQL umožňuje uživatelům definovat strukturu databáze (příkazy DDL), manipulovat s daty (příkazy DML), řídit přístup k datům (příkazy DCL) a spravovat transakce (příkazy TCL). Díky své jednoduchosti a standardizaci se stal SQL nejpoužívanějším jazykem pro databázové systémy.

## 3. Standardy jazyka
SQL je definován různými standardy, které zajišťují kompatibilitu a jednotnost v používání jazyka napříč různými databázovými systémy. Mezi nejdůležitější standardy patří:
- **SQL-86**: První standard, který zavedl základní syntaxi a konstrukce.
- **SQL-92**: Přinesl významná vylepšení včetně přidání subdotazů a integritních omezení.
- **SQL:1999**: Zavedl objektově-relační rozšíření, triggery a SQLJ pro integraci s Javou.
- **SQL:2003**: Přinesl podporu pro XML data, okna a analytické funkce.
- **SQL:2011**: Přidání standardizovaných temporálních datových typů a operací.

## 4. Rozdělení příkazů
SQL příkazy lze rozdělit do několika kategorií:
- **DDL (Data Definition Language)**: Příkazy pro definici struktury databáze.
  - `CREATE`: Vytvoření nové databáze, tabulky nebo jiného objektu.
  - `ALTER`: Změna struktury existující tabulky nebo objektu.
  - `DROP`: Odstranění databáze, tabulky nebo objektu.
  - `TRUNCATE`: Odstranění všech řádků z tabulky, ale zachování její struktury.

- **DML (Data Manipulation Language)**: Příkazy pro manipulaci s daty.
  - `SELECT`: Výběr dat z jedné nebo více tabulek.
  - `INSERT`: Vložení nových dat do tabulky.
  - `UPDATE`: Aktualizace existujících dat v tabulce.
  - `DELETE`: Odstranění dat z tabulky.

- **DCL (Data Control Language)**: Příkazy pro řízení přístupu k datům.
  - `GRANT`: Udělení práv na databázové objekty uživatelům.
  - `REVOKE`: Odebrání dříve udělených práv.

- **TCL (Transaction Control Language)**: Příkazy pro správu transakcí.
  - `COMMIT`: Potvrzení všech změn provedených v transakci.
  - `ROLLBACK`: Vrácení změn provedených v transakci zpět do stavu před zahájením transakce.
  - `SAVEPOINT`: Nastavení bodu v transakci, ke kterému se lze vrátit.

## 5. Primární a cizí klíče
- **Primární klíč (Primary Key)**: Unikátní identifikátor pro záznam v tabulce. Primární klíč musí být jedinečný pro každý záznam a nemůže obsahovat `NULL` hodnoty. Používá se k zajištění, že každý řádek v tabulce je jednoznačně identifikovatelný. Například tabulka `Employees` může mít sloupec `EmployeeID` jako primární klíč.

- **Cizí klíč (Foreign Key)**: Sloupec nebo soubor sloupců, které odkazují na primární klíč v jiné tabulce. Cizí klíče slouží k vytvoření vazby mezi tabulkami a zajišťují, že data mezi nimi zůstanou konzistentní. Například, pokud máme tabulky `Orders` a `Customers`, sloupec `CustomerID` v tabulce `Orders` může být cizím klíčem odkazujícím na `CustomerID` v tabulce `Customers`.

## 6. Relace, Relační vazby, referenční integrita
- **Relace**: V SQL databázích se data ukládají do tabulek, které jsou propojeny relacemi. Relace mezi tabulkami mohou mít různé typy:
  - **1:1 (jedna k jedné)**: Jeden řádek v tabulce A odpovídá jednomu řádku v tabulce B.
  - **1:N (jedna k mnoha)**: Jeden řádek v tabulce A může odpovídat více řádkům v tabulce B.
  - **N:M (mnoho k mnoha)**: Více řádků v tabulce A může odpovídat více řádkům v tabulce B, což obvykle vyžaduje třetí, spojovací tabulku.

- **Referenční integrita**: Tento koncept zajišťuje, že vztahy mezi tabulkami jsou platné a konzistentní. Například referenční integrita zajišťuje, že nelze vložit záznam do tabulky `Orders` s neexistujícím `CustomerID`, pokud je `CustomerID` cizím klíčem odkazujícím na tabulku `Customers`.

#### Pravidla referenční integrity v SQL Serveru

Referenční integrita v SQL Serveru je klíčovým konceptem pro zajištění konzistence a správnosti dat v databázích. Umožňuje správnou vazbu mezi tabulkami a zajišťuje, že vztahy mezi nimi jsou udržovány podle definovaných pravidel. Níže jsou uvedena hlavní pravidla referenční integrity:

1. **Cizí klíč (Foreign Key)**  
   Cizí klíč je sloupec nebo skupina sloupců v tabulce, které odkazují na primární klíč (Primary Key) v jiné tabulce. Tento vztah zajišťuje, že hodnoty ve sloupci cizího klíče odpovídají existujícím hodnotám v tabulce, na kterou se odkazují.

2. **Primární klíč (Primary Key)**  
   Primární klíč je sloupec nebo skupina sloupců, které jednoznačně identifikují každý řádek v tabulce. V tabulce může být pouze jeden primární klíč a žádná jeho hodnota nesmí být NULL ani duplicitní.

3. **Akce při aktualizaci a mazání (ON UPDATE/ON DELETE)**  
   Tato pravidla určují, co se stane s hodnotami cizího klíče, když se změní nebo smaže odpovídající hodnota v primárním klíči:

   - **ON UPDATE CASCADE:** Automaticky aktualizuje cizí klíče, když se změní primární klíč.
   - **ON DELETE CASCADE:** Automaticky smaže řádky obsahující cizí klíče, když se smaže odpovídající řádek v tabulce s primárním klíčem.
   - **ON DELETE SET NULL:** Nastaví cizí klíče na NULL, pokud je odpovídající řádek s primárním klíčem smazán.
   - **ON DELETE SET DEFAULT:** Nastaví cizí klíče na výchozí hodnotu, pokud je odpovídající řádek s primárním klíčem smazán.

4. **Kontrola existence (Referential Integrity Check)**  
   SQL Server zajišťuje, že žádný řádek nemůže být vložen do tabulky s cizím klíčem, pokud odpovídající hodnota neexistuje v tabulce s primárním klíčem. Tato kontrola zajišťuje, že všechny odkazy mezi tabulkami jsou platné.


## 7.  Datové typy sloupců v SQL Serveru

Datové typy sloupců v SQL Serveru určují, jaký typ dat může sloupec uchovávat. Výběr správného datového typu je klíčový pro optimalizaci výkonu a efektivitu úložiště. SQL Server nabízí širokou škálu datových typů, které lze rozdělit do několika kategorií:

### 1. Numerické datové typy
Numerické datové typy jsou určeny pro uložení číselných hodnot. Patří sem:
- **INT**: Celá čísla v rozsahu -2,147,483,648 až 2,147,483,647.
- **BIGINT**: Větší celá čísla, v rozsahu -9,223,372,036,854,775,808 až 9,223,372,036,854,775,807.
- **SMALLINT**: Menší celá čísla v rozsahu -32,768 až 32,767.
- **TINYINT**: Nepodepsaná celá čísla v rozsahu 0 až 255.
- **DECIMAL(p, s)** nebo **NUMERIC(p, s)**: Čísla s pevnou přesností a měřítkem, kde `p` určuje počet číslic a `s` počet číslic za desetinnou čárkou.
- **FLOAT** a **REAL**: Čísla s plovoucí desetinnou čárkou, používaná pro hodnoty, kde je požadována vysoká přesnost.
- **MONEY**: Používá se pro ukládání peněžních hodnot s pevnou přesností na čtyři desetinná místa. Rozsah hodnot je od -922,337,203,685,477.5808 do 922,337,203,685,477.5807.
- **SMALLMONEY**: Menší verze datového typu `MONEY`, ukládá peněžní hodnoty s pevnou přesností na čtyři desetinná místa a s rozsahem od -214,748.3648 do 214,748.3647.

### 2. Řetězcové datové typy
Řetězcové datové typy se používají pro uložení textu nebo řetězců znaků:

#### CHAR (Fixed-length character)
- **Pevná délka:** Datový typ `CHAR` má pevnou délku, což znamená, že pokud je definován jako `CHAR(10)`, každý záznam v tomto sloupci bude mít délku 10 znaků. Pokud je vložený řetězec kratší než 10 znaků, SQL Server automaticky doplní chybějící znaky prázdnými místy (spaces).
- **Použití:** `CHAR` je vhodný pro ukládání textových dat, která mají přesně stanovenou délku, jako jsou kódy, identifikační čísla nebo zkratky.

#### VARCHAR (Variable-length character)
- **Proměnná délka:** Datový typ `VARCHAR` má proměnnou délku, což znamená, že je možné uložit řetězce různé délky, až do maximální délky specifikované při definici (např. `VARCHAR(50)`). SQL Server ukládá pouze skutečnou délku vloženého řetězce, což může ušetřit místo v případě, že jsou uloženy kratší řetězce.
- **Použití:** `VARCHAR` je vhodný pro ukládání textových dat, jejichž délka se může výrazně lišit, jako jsou jména, adresy nebo popisy.

### 3. Datumové a časové datové typy
Tyto datové typy jsou určeny pro uložení informací o datu a čase:
- **DATE**: Ukládá datum (rok, měsíc, den).
- **TIME**: Ukládá čas (hodiny, minuty, sekundy).
- **DATETIME**: Ukládá datum a čas, s přesností na sekundy.
- **SMALLDATETIME**: Ukládá datum a čas, s přesností na minuty.
- **DATETIME2**: Ukládá datum a čas s vyšší přesností než `DATETIME`.
- **DATETIMEOFFSET**: Ukládá datum a čas včetně časového pásma.

### 4. Binární datové typy
Pro ukládání binárních dat, jako jsou obrázky nebo soubory:
- **BINARY(n)**: Pevná délka binárních dat.
- **VARBINARY(n)**: Proměnná délka binárních dat, kde `n` určuje maximální počet bajtů.
- **IMAGE**: Používal se pro velmi velká binární data, nyní je doporučeno používat `VARBINARY(MAX)`.

### 5. Další datové typy
- **BIT**: Používá se pro ukládání hodnot pravda/nepravda, 0 nebo 1.
- **UNIQUEIDENTIFIER**: Používá se pro ukládání globálně unikátních identifikátorů (GUID).
- **XML**: Speciální typ pro uložení dat ve formátu XML.
- **GEOMETRY** a **GEOGRAPHY**: Používají se pro ukládání prostorových dat, jako jsou souřadnice a geometrické tvary.

Volba správného datového typu je důležitá pro optimalizaci výkonu databáze a správu úložiště. Při návrhu tabulek je třeba pečlivě zvážit potřeby aplikace, zejména pokud jde o velikost a rozsah dat.


## Používání uvozovek, jednoduchých uvozovek, zpětných apostrofů, závorek a komentářů v SQL Serveru

### Uvozovky (Double Quotes)

V SQL Serveru se uvozovky používají k označení názvů objektů, jako jsou tabulky nebo sloupce, které obsahují speciální znaky nebo jsou klíčovými slovy. Uvozovky mohou také sloužit k zachování malých a velkých písmen v názvech objektů, pokud je to vyžadováno, ačkoliv SQL Server obvykle nerozlišuje malá a velká písmena, pokud není specifikována case-sensitive kolace.

### Jednoduché uvozovky (Single Quotes)

Jednoduché uvozovky se používají k označení textových literálů. Všechny textové hodnoty musí být obklopeny jednoduchými uvozovkami. Pokud je nutné vložit jednoduchou uvozovku do textového řetězce, používají se dvojité jednoduché uvozovky uvnitř řetězce.

### Zpětné apostrofy (Backticks)

V SQL Serveru se zpětné apostrofy běžně nepoužívají. Místo toho se k označení názvů objektů, které obsahují speciální znaky nebo mezery, používají hranaté závorky nebo dvojité uvozovky. Použití zpětných apostrofů může vést k syntaktické chybě, protože nejsou v T-SQL standardem.

### Malá a velká písmena v příkazech

SQL Server je obvykle case-insensitive, což znamená, že nerozlišuje mezi malými a velkými písmeny v příkazech a názvech objektů. Klíčová slova SQL, jako `SELECT`, `FROM` a `WHERE`, mohou být psána v jakékoliv kombinaci malých a velkých písmen. Pokud je však použita kolace, která rozlišuje malá a velká písmena, může SQL Server rozlišovat písmena i v názvech objektů a hodnotách.

### Práce se závorkami

1. **Kulaté závorky (Parentheses)**: Používají se k určení pořadí operací, vytváření poddotazů, definování argumentů funkcí a při práci s výrazovými seznamy. Kulaté závorky jsou základním prvkem syntaxe pro správnou strukturu a čitelnost složitých dotazů.

2. **Hranaté závorky (Square Brackets)**: Slouží k označení názvů objektů, jako jsou tabulky a sloupce, které obsahují mezery, speciální znaky nebo jsou rezervovanými slovy v SQL. Pomáhají také zachovat malá a velká písmena v názvech objektů, pokud je to vyžadováno.

3. **Složené závorky (Curly Braces)**: V T-SQL se složené závorky běžně nepoužívají jako součást syntaxe SQL. Mohou se však objevit v některých nástrojích pro správu databází nebo při použití rozšířených funkcí, jako jsou CTE (Common Table Expressions) nebo při tvorbě dynamických SQL dotazů.

### Komentáře

Komentáře jsou v SQL Serveru používány pro přidávání poznámek k SQL kódu, které nejsou vykonávány databázovým systémem. Existují dva hlavní způsoby, jak psát komentáře:

1. **Jednořádkové komentáře**: Označují se dvěma pomlčkami (`--`). Všechny znaky po těchto pomlčkách až do konce řádku jsou považovány za komentář.

2. **Víceřádkové komentáře**: Označují se začátkem `/*` a koncem `*/`. Všechny znaky mezi těmito symboly jsou považovány za komentář, což umožňuje komentovat bloky kódu přes více řádků.

### Shrnutí

- **Uvozovky**: Používají se k označení objektů s nestandardními názvy nebo speciálními znaky.
- **Jednoduché uvozovky**: Používají se pro textové literály.
- **Zpětné apostrofy**: V SQL Serveru se nepoužívají a mohou způsobit syntaktickou chybu.
- **Malá a velká písmena**: SQL Server je obvykle case-insensitive, pokud není použita kolace rozlišující písmena.
- **Kulaté závorky**: Používají se pro výrazy, poddotazy a argumenty funkcí.
- **Hranaté závorky**: Používají se pro názvy objektů s mezerami, speciálními znaky nebo pro zachování specifického formátování.
- **Složené závorky**: Obvykle se v SQL Serveru nepoužívají, ale mohou být viditelné v pokročilých funkcích nebo nástrojích.
- **Komentáře**: Používají se pro přidání poznámek do SQL kódu, což usnadňuje jeho čitelnost a údržbu, přičemž existují jednořádkové (`--`) a víceřádkové (`/* */`) formáty.

Tyto prvky jsou důležité pro správnou syntaxi a sémantiku SQL dotazů v SQL Serveru a mohou ovlivnit jak čitelnost kódu, tak i jeho správné provedení.


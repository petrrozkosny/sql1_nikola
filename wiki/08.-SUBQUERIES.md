## Introduction to Subqueries

Subqueries, sometimes referred to as nested queries, are queries embedded within another SQL query. They are used to perform more complex operations that would be difficult to achieve with a single query alone. Subqueries can be used in various parts of an SQL statement, such as the `SELECT`, `WHERE`, `FROM`, or `HAVING` clauses.

### Types of Subqueries

1. **Scalar Subqueries**: Return a single value that can be used as an expression in another query.
   
2. **Row Subqueries**: Return one or more rows, but always with the same number of columns, which can be compared to another row in the query.
   
3. **Table Subqueries**: Return a whole table of data, which can be used in the `FROM` clause as a data source for the outer query.

```sql
SELECT, dt.location,dt.year,dt.avg_prcp
FROM (
    SELECT location, YEAR(date) AS rok, AVG(prcp) AS avg_prcp
    FROM data_new
    GROUP BY location, YEAR(date)
) AS dt
WHERE dt.avg_prcp> 10;
```


## Using Subqueries as Derived Tables

A derived table is a subquery listed in the `FROM` clause of the main query, which behaves like a temporary table. This subquery must always be named (assigned an alias) and can be used to perform additional operations in the main query.

**Characteristics:**
- The subquery is defined in the `FROM` clause of the main query.
- The result of the subquery is treated as a temporary table.
- The temporary table must have an alias.
- Used for more complex queries where the results of the subquery are further processed in the main query.

## Using Subqueries with the `WITH` Clause (CTE - Common Table Expressions)

The `WITH` clause, also known as CTE (Common Table Expressions), provides a way to define temporary results that can be referenced within the main query. A CTE is declared before the main query and can be used throughout the query, improving readability and structure of complex queries.

**Characteristics:**
- The `WITH` clause is placed at the beginning of the query.
- Defines a temporary result set that can be used throughout the query.
- CTE can improve the readability and structure of complex queries.
- Allows the same temporary result set to be used multiple times within the query.

```sql
WITH tbl_avg_prcp AS (
    SELECT location, YEAR(date), AVG(prcp) AS avg_prcp
    FROM data_new
    GROUP BY location, YEAR(date)
)
SELECT location, year, avg_prcp
FROM tbl_avg_prcp
WHERE avg_prcp  > 10;
```


### Using Subqueries

- **In the SELECT Clause**: A subquery can be used to compute a value for each row in the result set.
- **In the WHERE Clause**: Using a subquery in the `WHERE` clause allows you to filter data based on a condition that depends on the result of the subquery.
- **In the FROM Clause**: Subqueries can be used to create virtual tables that are further processed by outer queries.
- **In the HAVING Clause**: Subqueries can be used to filter aggregated results.

### Utilization and Benefits of Subqueries

- **Modularity**: Subqueries allow you to break down complex queries into smaller, more manageable parts.

- **Flexibility**: They enable the use of results from one query in other parts of the query, which can be very useful for performing complex calculations or filtering data.

- **Code Simplification**: Subqueries can reduce the need to repeat similar logic in different parts of the query, which simplifies maintenance and improves code readability.


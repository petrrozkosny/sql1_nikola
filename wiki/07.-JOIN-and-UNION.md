## Joining Data from Multiple Tables

Joining data from multiple tables is a key aspect of working with relational databases. Using the `JOIN` clause, we can combine rows from two or more tables based on related columns, allowing us to obtain a comprehensive view of the data.

### Basic Types of JOIN Clauses

SQL provides several types of `JOIN` clauses that determine how records from tables are combined:

- **INNER JOIN**: Returns only the rows that have matching records in both tables.

- **LEFT JOIN (LEFT OUTER JOIN)**: Returns all rows from the left table and the matching rows from the right table. If there is no matching row, the values from the right table are replaced with NULL.

- **RIGHT JOIN (RIGHT OUTER JOIN)**: Returns all rows from the right table and the matching rows from the left table. If there is no matching row, the values from the left table are replaced with NULL.

- **FULL JOIN (FULL OUTER JOIN)**: Returns all rows when there is a match in one of the tables. If there is no match, NULL is returned for columns where there is no corresponding record.


```sql
SELECT country, location, AVG(prcp) avg_prcp
FROM data_new
LEFT JOIN dim_locations ON data_new.location = dim_locations.station
WHERE country = 'Cesko'
GROUP by country,location
```

 ### Things to Watch Out for When Using JOIN

- **Join Conditions**: Ensure that join conditions are correctly defined to avoid incorrect data joining. Using incorrect or incomplete join conditions can lead to inaccurate results.

- **Query Performance**: Large datasets can slow down query performance, especially if not properly indexed. Using filters in the `WHERE` clause and indexing columns used in join conditions can improve performance.

- **Cardinality Issues**: Joining tables on columns with high cardinality (large number of unique values) can lead to unexpected results, such as row multiplication. It is important to ensure that join conditions are appropriately defined.

### Self-Joining Tables

This type of join is called a **self-join** and is used when you need to compare records in a table with itself. Typically, table aliasing is used to distinguish between different instances of the table in the query.

### UNION, UNION ALL, EXCEPT, INTERSECT

These clauses are used to combine results from multiple queries.

- **UNION**: Combines the results of two queries and removes duplicates. Be mindful of performance, especially with large datasets, as removing duplicates can be resource-intensive. 

 ```sql
SELECT * FROM data_new
UNION
SELECT * FROM data_old
```

- **UNION ALL**: Combines the results of two queries, including duplicates. It is faster than `UNION` because it does not remove duplicates.

 ```sql
SELECT * FROM data_new
UNION ALL
SELECT * FROM data_old
``` 
- **EXCEPT**: Returns the difference between two queries. It returns rows from the first query that are not present in the second query.

 ```sql
SELECT * FROM data_new
EXCEPT EXCEPT
SELECT * 
 ```

- **INTERSECT**: Returns the intersection between two queries, meaning only the rows that are present in both queries.
 
 ```sql
SELECT * FROM data_new
EXCEPT INTERSECT
SELECT * 
 ```

### Things to Watch Out for When Using UNION, UNION ALL, EXCEPT, INTERSECT

- **Data Types and Column Structure**: Ensure that all queries combined using `UNION`, `UNION ALL`, `EXCEPT`, or `INTERSECT` have the same number of columns and matching data types; otherwise, an error will occur.

- **Result Order**: If the order of results is important, use `ORDER BY` at the end of the combined query. Note that `ORDER BY` applies to the entire result of the combined query, not to individual queries.

### Selecting Unique Data from Two Tables

Combining `UNION` with `SELECT DISTINCT` is often used to obtain unique records from two tables. `UNION` automatically removes duplicates, while `UNION ALL` includes all results, including duplicates.
